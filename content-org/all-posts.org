#+HUGO_BASE_DIR: ../
#+HUGO_SECTION: ./post/

* Quantum Computing
  Posts about quantum computing in general.
** TODO Understanding the Hadamard-Overlap test
   :PROPERTIES:
   :EXPORT_FILE_NAME: 2020-02-05-understanding-the-hadamard-overlap-test
   :EXPORT_DATE: 2020-02-05
   :END:

   The Hadamard test is a quantum algorithm that can approximate the value 
   of $\langle x \vert U \vert x \rangle$ provided that $\vert x \rangle$ is a 
   quantum state that can be constructed [^1] and $U$ is a unitary matrix 
   implemented by a quantum circuit.
   
   But what about the Hadamard-Overlap test? Have you ever heard about it? I
   personally did not until reading
   [Variational Quantum Linear Solver: A Hybrid Algorithm for Linear Systems](http://arxiv.org/abs/1909.05820v1)
   [^2].

   The goal of the Hadamard-Overlap test is to estimate the quantity
   $$
   c = \langle 0 \vert V_2^\dagger U_1 V_1 \vert 0 \rangle \langle 0 \vert V_1^\dagger
   U_2 V_2 \vert 0 \rangle,
   $$
   with $U_1$, $U_2$, $V_1$ and $V_2$ being unitary matrices.

*** The Hadamard-Overlap algorithm   

    To estimate the quantity 
    $$
    c = \langle 0 \vert V_2^\dagger U_1 V_1 \vert 0 \rangle \langle 0 \vert V_1^\dagger
    U_2 V_2 \vert 0 \rangle,
    $$
    the Hadamard-Overlap test executes the circuit below and perform a step of 
    post-processing on the results of the measurements.

    # 1. The Hadamard test, presented succintely in the next section of this post.
    # 2. The SWAP test, depicted in the figure below.

    # {{< figure 
    # library="true" 
    # src="swap-test-circuit.png" 
    # title="Canonical SWAP test circuit that compares two quantum states." 
    # lightbox="true" >}}

    # The full Hadamard-Overlap test used to approximate the complex $c$ is:

    {{< figure 
    library="true" 
    src="hadamard-overlap-test.png" 
    title="Hadamard-Overlap test circuit. The circuit boxed in red is the destructive-SWAP test devised in [SWAP test and Hong-Ou-Mandel effect are equivalent](https://doi.org/10.1103/PhysRevA.87.052330). The $S^\dagger$ gate in blue should be removed (resp. included) if we want to estimate the real-part $\Re(c)$ (resp. imaginary-part $\Im(c)$) of $c$." 
    lightbox="true" >}}

    The above quantum circuit is depicted almost identically in 
    [Variational Quantum Linear Solver: A Hybrid Algorithm for Linear Systems](http://arxiv.org/abs/1909.05820v1)
    along with a /short/ explanation of the post-processing needed on the measured values
    $o_a$, $\left\{ o_i^1 \right\}_i$ and $\left\{ o_i^2 \right\}_i$ to compute our approximate
    of the value $c$.

    But when implementing this Hadamard-Overlap test, I found out that the explanation provided
    in the paper was too short and concise to be able to understand clearly what post-processing
    one should perform to obtain the expected result: $\Re(c)$ or $\Im(c)$ depending on the inclusion
    of the $S^\dagger$ gate.

    In this post, I will share the developments that lead me to clarify the post-processing 
    needed to obtain an estimation of $\Re(c)$ or $\Im(c)$.

*** Analysis of the Hadamard-Overlap circuit

    In order to analyse the Hadamard-Overlap circuit and to devise the correct way of post-processing
    the outputs given by the measurements at the end of the circuit, we should first have a good
    understanding of the action of the quantum circuit on the quantum state it is applied on. The
    best way to understand how the quantum circuit evolves the quantum state 
    $\vert 0 \rangle^{\otimes (2n+1)}$ that is given as input is to compute the state of the $2n+1$
    qubits at the end of the circuit.

    To do so, a little study of the original Hadamard test algorithm is beneficial.

**** The Hadamard test

     The quantum circuit implementing the Hadamard test is:

     {{< figure 
     library="true" 
     src="hadamard-test-circuit.png" 
     title="Hadamard test circuit that measures the real (or imaginary if the blue $S^\dagger$ gate is included in the circuit) expected value of a unitary. Note that the $S^\dagger$ gate commutes with the controlled-$U$ gate, which means that they can be swapped without affecting the output of the circuit." 
     lightbox="true" >}}

     It is easy to show that, before the measurement of the ancilla qubit, the $n+1$ qubits are in
     the state
     $$
     \vert \Psi \rangle = \frac{\vert 0 \rangle \otimes \left( I + sU \right) \vert \psi \rangle + \vert 1 \rangle \left( I - sU \right) \vert \psi \rangle}{2} 
     $$
     where $I$ is the identity operator and 
     $$
     s = \left\{\begin{split}
     -i & \quad \text{if the } S^\dagger \text{ gate has been applied} \\
     1 & \quad \text{otherwise}
     \end{split}\right.
     $$
    
**** Back to the Hadamard-Overlap test
     
     Looking back attentively at the beginning of the Hadamard-Overlap test and remembering
     that the $S^\dagger$ gate commutes with the controlled-$U$ gate, we can see that the
     Hadamard-Overlap test starts with a regular Hadamard test where:
     - The input state $\vert \psi \rangle$ is composed of $2n$ qubits instead of the $n$-qubit state
       in the original Hadamard-test.
     - $U = U_1 \otimes U_2$.
     - $\vert \psi \rangle = (V_1 \otimes V_2) \vert 0 \rangle$.

     In order to avoid confusion with the states dimensions, let use $\vert S_1 \rangle$ and 
     $\vert S_2 \rangle$ for the two $n$-qubit quantum states composing the $2n$-qubit input
     state $\vert \psi \rangle$, i.e. 
     $\vert \psi \rangle = \vert S_1 \rangle \otimes \vert S_2 \rangle$.
     
     Replacing $U$ and $\vert \psi \rangle$ in the expression of $\vert\Psi\rangle$ by the values
     listed above gives us the quantum state
     $$\begin{align}
     \vert &\Psi_{2n} \rangle = \frac{\vert 0 \rangle \otimes \left( I + sU \right) \vert \psi \rangle + \vert 1 \rangle \left( I - sU \right) \vert \psi \rangle}{2} \\
     %&= \vert 0 \rangle \otimes \frac{\left( I + s(U_1 \otimes U_2) \right) \vert S_1 \rangle \vert S_2 \rangle}{2} + \vert 1 \rangle \otimes \frac{\left( I - s(U_1 \otimes U_2) \right) \vert S_1 \rangle \vert S_2 \rangle}{2} \\
     &= \vert 0 \rangle \frac{ \vert S_1 \rangle \vert S_2 \rangle + s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle}{2} + \vert 1 \rangle \frac{ \vert S_1 \rangle \vert S_2 \rangle - s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle}{2} \\
     \end{align}$$

     This means that, by ignoring the destructive SWAP test performed in the red part of the circuit,
     we have access to the quantum state
     $$
     \vert \phi_{\vert 0\rangle} \rangle = \frac{ \vert S_1 \rangle \vert S_2 \rangle + s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle}{2}
     $$
     if we measured the first ancilla qubit in the state $\vert 0 \rangle$ or
     $$
     \vert \phi_{\vert 1\rangle} \rangle = \frac{ \vert S_1 \rangle \vert S_2 \rangle - s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle}{2}
     $$
     if the first ancilla qubit has been measured in the state $\vert 1 \rangle$.

     Looking back at where we are, we computed the exact state of the qubits *before* applying the 
     SWAP test. Our next step will be to apply the SWAP test and see how the state evolves.

**** The SWAP test

     The SWAP test is a quantum algorithm that can be used to estimate how much two quantum states
     $\vert \psi_1 \rangle$ and $\vert \psi_2 \rangle$ differ from each other. 

     {{< figure 
     library="true" 
     src="swap-test-circuit.png" 
     title="Original SWAP test circuit that can be used to estimate how much $\vert \psi_1 \rangle$ and $\vert \psi_2 \rangle$ differ." 
     lightbox="true" >}}
     
     It can be shown that the measurement on the ancilla qubit will yield $\vert 0 \rangle$ with a 
     probability of $\frac{1 + \vert \langle \psi_2 \vert \psi_1 \rangle \vert^2}{2}$. By repeating 
     this measurement a sufficient number of times, it become possible to estimate with a good 
     precision the value $\vert \langle \psi_2 \vert \psi_1 \rangle \vert^2$, which can be seen as
     a measure of the overlap between $\vert \psi_1 \rangle$ and $\vert \psi_2 \rangle$.
     
     This version of the SWAP test has been studied thoroughly and an *equivalent* quantum circuit
     that do not require any ancilla qubit can be found in 
     [SWAP test and Hong-Ou-Mandel effect are equivalent](https://doi.org/10.1103/PhysRevA.87.052330).

     {{< figure 
     library="true" 
     src="destructive-swap-test-circuit.png" 
     title="Modified SWAP test circuit that does not require any ancilla qubit. Post-processing of the values $\left\{ o_i^1 \right\}_i$ and $\left\{ o_i^2 \right\}_i$ is, on the other hand, required." 
     lightbox="true" >}}

     With this modified version of the SWAP test, the test is successful (equivalent of measuring
     the state $\vert 0 \rangle$ with the original circuit) if and only if the bitwise-and of the
     bit-strings formed by $\left\{ o_i^1 \right\}_i$ and $\left\{ o_i^2 \right\}_i$ has an even
     number of ones. Mathematically, the test is successful if
     $$
     \sum_{i=1}^n o_i^1 \land o_i^2 \equiv 0 \pmod{2}.
     $$

     The two test being equivalent in the sense that they provide the same results, they can
     be used interchangeably. We will use this equivalence in the next section to make the maths 
     simpler.

**** Back to the Hadamard-Overlap test (bis)

     We left our Hadamard-Overlap test circuit halfway computed to study the SWAP test. It turns out
     that the Hadamard-Overlap algorithm uses the modified version of the SWAP test that does not
     require any additional ancilla qubits.

     To simplify the mathematical expressions, we will use the equivalence between the original SWAP
     test algorithm and the modified version used in the Hadamard-overlap test to change the quantum
     circuit in the red box by the original SWAP test.
     To do so, we introduce a /virtual/ ancillary qubit, i.e. an ancillary qubit that we will use
     during the mathematical analysis but that will not appear on the quantum circuit diagram.
     In order to isolate correctly this /virtual/ ancilla qubit, its state will be colored in 
     $\textcolor{red}{\text{red}}$.

     Finally, in order to avoid re-doing the computation for both $\vert \phi_{\vert 0\rangle} \rangle$
     and $\vert \phi_{\vert 1\rangle} \rangle$ we will use a $\textcolor{blue}{\pm}$ sign to account
     for both states (and $\textcolor{blue}{\mp}$ if there is a sign negation):

     $$
     \vert \phi_{\vert \dot{}\rangle} \rangle = \frac{ \vert S_1 \rangle \vert S_2 \rangle \textcolor{blue}{\pm} s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle}{2}.
     $$

     Lets start the SWAP test by adding the virtual ancilla to the state:
     $$
     \vert \phi_{\vert \dot{}\rangle} \rangle = \textcolor{red}{\vert 0 \rangle} \frac{ \vert S_1 \rangle \vert S_2 \rangle \textcolor{blue}{\pm} s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle}{2}.
     $$
     Following the algorithm, we apply a $H$ gate to the virtual ancilla:
     $$
     \vert \phi_{\vert \dot{}\rangle} \rangle = \textcolor{red}{\frac{\vert 0 \rangle + \vert 1 \rangle}{\sqrt{2}}} \frac{ \vert S_1 \rangle \vert S_2 \rangle \textcolor{blue}{\pm} s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle}{2}.
     $$
     Performing the controlled-SWAP operation gives us the state
     $$\begin{align}
     \vert \phi_{\vert \dot{}\rangle} \rangle =& \frac{ \textcolor{red}{\vert 0 \rangle} \left(\vert S_1 \rangle \vert S_2 \rangle \textcolor{blue}{\pm} s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle \right)}{2 \textcolor{red}{\sqrt{2}}}\\
     +& \frac{\textcolor{red}{\vert 1 \rangle} \left(\vert S_2 \rangle \vert S_1 \rangle \textcolor{blue}{\pm} s U_2\vert S_2 \rangle U_1 \vert S_1 \rangle \right)}{2 \textcolor{red}{\sqrt{2}}},
     \end{align}$$
     which will then finally be transformed by another $H$ gate to
     $$\begin{align}
     \vert \phi_{\vert \dot{}\rangle} \rangle =& \frac{ \left(\textcolor{red}{\vert 0 \rangle + \vert 1 \rangle}\right) \left(\vert S_1 \rangle \vert S_2 \rangle \textcolor{blue}{\pm} s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle \right)}{2 \times \textcolor{red}{2}} \\
     +& \frac{\left(\textcolor{red}{\vert 0 \rangle - \vert 1 \rangle}\right) \left(\vert S_2 \rangle \vert S_1 \rangle \textcolor{blue}{\pm} s U_2\vert S_2 \rangle U_1 \vert S_1 \rangle \right)}{2 \times \textcolor{red}{2}}
     \end{align}$$
     Factorising by the state of the virtual ancilla, we obtain the expression
     $$\begin{align}
     \vert \phi_{\vert \dot{}\rangle} \rangle =& \frac{ \textcolor{red}{\vert 0 \rangle} \left(\vert S_1 \rangle \vert S_2 \rangle + \vert S_2 \rangle \vert S_1 \rangle \textcolor{blue}{\pm} s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle \textcolor{blue}{\pm} s U_2\vert S_2 \rangle U_1 \vert S_1 \rangle \right)}{4} \\
     +& \frac{\textcolor{red}{\vert 1 \rangle} \left(\vert S_1 \rangle \vert S_2 \rangle - \vert S_2 \rangle \vert S_1 \rangle \textcolor{blue}{\pm} s U_1\vert S_1 \rangle U_2 \vert S_2 \rangle \textcolor{blue}{\mp} s U_2\vert S_2 \rangle U_1 \vert S_1 \rangle \right)}{4}
     \end{align}$$

     Because of the introduction of the virtual ancilla qubit, the state 
     $\vert \phi_{\vert \dot{}\rangle} \rangle$ is not exactly the state we would have with the
     modified version of the SWAP test. 

     But wait! We did not processed all this calculus for nothing. Thanks to the last expression of
     $\vert \phi_{\vert \dot{}\rangle} \rangle$, we are now able to compute the probability to have a 
     successful SWAP test: it is the probability to measure the virtual ancilla introduced in the
     state $\vert 0 \rangle$. And as the original SWAP test and its modified version are equivalent,
     their probability of success (and failure) is the same.

     Let call $P_{\vert i \rangle}(0)$ the probability of success of the modified SWAP test in the
     Hadamard-Overlap circuit when the ancillary qubit was measured in the state $\vert i \rangle$.
     Note that the $\vert i \rangle$ is *not* $\textcolor{red}{\text{red}}$ here. We are speaking of
     the real ancillary qubit in the Hadamard-Overlap algorithm, not the virtual one.
     
     Conversely, let call $P_{\vert i \rangle}(0)$ the probability of failure of the modified
     SWAP test.
     
     

# **** Hadamard-test   

#      The Hadamard-overlap algorithm uses the Hadamard-test as depicted at the beginning of this article with the following
#      values for $U$ and $\vert \psi \rangle$:
#      - $U$ a unitary that acts on $2n$ qubits: $U = V_1 \otimes V_2$.
#      - $\vert \psi\rangle$ a quantum state on $2n$ qubits with $\vert \psi \rangle = \left(U_2 \otimes U_1\right) \vert 0 \rangle$. 
       
#      Once the Hadamard-test 
       

#    {{< figure 
#    library="true" 
#    src="destructive-swap-test-circuit.png" 
#    title="Equivalent SWAP test circuit that compares two quantum states without needing an additional ancilla qubit. The classical values $O_i^j$ should be classically post-processed to know the result of the test." 
#    lightbox="true" >}}

*** Research articles cited in this post

    - Carlos Bravo-Prieto, Ryan LaRose, M. Cerezo, Yigit Subasi, Lukasz Cincio, Patrick J. Coles, “Variational quantum linear solver: A hybrid algorithm for linear systems” [arXiv:1909.05820 (2019)](http://arxiv.org/abs/1909.05820v1).
    - J. C. Garcia-Escartin and P. Chamorro-Posada, “SWAP test and Hong-Ou-Mandel effect are equivalent,” [Phys. Rev. A 87, 052330 (2013)](http://dx.doi.org/10.1103/PhysRevA.87.052330).


    [^1]: i.e. there exists a quantum circuit $C$ such as $C\vert 0 \rangle = \vert x \rangle$.
    [^2]: I am still trying to find a good way to cite with 
          [Hugo Academic](https://sourcethemes.com/academic/). Maybe an answer to 
          [#830](https://github.com/gcushen/hugo-academic/issues/830) will make the process
          of citing scientific papers more writer & reader friendly. For the moment, all the 
          research articles will be cited in the main text with their title and a link pointing
          to the article and at the end of the post with a format that mimics the usual citation
          format of research articles.
    
